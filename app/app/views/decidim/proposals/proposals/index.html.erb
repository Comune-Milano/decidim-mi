<%= render partial: "decidim/shared/component_announcement" %>

<% if component_settings.geocoding_enabled? %>
  <%= dynamic_map_for proposals_data_for_map(@proposals.select(&:geocoded?)) do %>
    <template id="marker-popup">
      <div class="map-info__content">
        <h3>${title}</h3>
        <div id="bodyContent">
          <p>{{html body}}</p>
          <div class="map__date-adress">
            <div class="address card__extra">
              <div class="address__icon">{{html icon}}</div>
              <div class="address__details">
                <span>${address}</span><br>
              </div>
            </div>
          </div>
          <div class="map-info__button">
            <a href="${link}" class="button button--sc">
              <%= t(".view_proposal") %>
            </a>
          </div>
        </div>
      </div>
    </template>
    <%= stylesheet_link_tag "decidim/map" %>
    <%= javascript_include_tag "decidim/map" %>
  <% end %>
<% end %>
<%= render partial: "voting_rules" %>
<div class="row columns">
  <div class="title-action">
    <h2 id="proposals-count" class="title-action__title section-heading">
      <%= render partial: "count" %>
    </h2>

    <%# if current_user != nil && (current_user.admin? || current_user.officialized?) %>
      <% if current_settings.creation_enabled && current_component.participatory_space.can_participate?(current_user) %>
        <%= action_authorized_link_to :create, new_proposal_path, class: "title-action__action button small", data: { "redirect_url" => new_proposal_path } do %>
          <%= t(".new_proposal") %>
          <%= icon "plus" %>
        <% end %>
      <% else %>
        <span class="title-action__action button small hollow disabled">
          <%= t(".new_proposal") %>
          <%= icon "plus" %>
        </span>
      <% end %>
    <%# end %>

    <% if component_settings.collaborative_drafts_enabled? %>
      <%= link_to t(".collaborative_drafts_list"), collaborative_drafts_path, class: "title-action__action button small hollow ml-s" %>
    <% end %>
  </div>
</div>
<div class="row">
  <div class="columns mediumlarge-4 large-3">
    <%= render partial: "filters_small_view" %>
    <div class="card card--secondary show-for-mediumlarge">
      <%= render partial: "filters" %>
    </div>
  </div>
  <div id="proposals" class="columns mediumlarge-8 large-9">
    <%= render partial: "proposals" %>
  </div>
</div>
<div class="row">
<div class="text-right">
  <%= link_to t(".see_all_withdrawn"), proposals_path("filter[state]" => "withdrawn") %>
</div>
</div>

<!-- Login modal -->

<div class="reveal" id="loginModal" data-reveal style="width: 450px">
  <div class="reveal__header">
    <h3 class="reveal__title ciao" style="font-size: 24px">Per proseguire clicca su ACCEDI</h3>
    <button class="close-button" data-close aria-label="Close modal"
      type="button">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
    <div class="row">
	    
      <!--

      <div class="columns medium-8 medium-centered" style="display:none">
            <div>
              <div class="field">
              </div>
              <div class="field">
              </div>
            </div>
            <div class="actions">
            </div>
            <p class="text-center">
            </p>
          <p class="text-center">
          </p>
      </div>
       
      -->
      <div>
         <a class="button expanded" href="/users/auth/saml">Accedi</a>
      </div>
    </div>
    
</div>

<!-- fine -->


<%= javascript_include_tag("decidim/filters") %>
<%= javascript_include_tag "decidim/orders" %>


<style>
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
}

.modal-content {
  border-radius: 8px;
}

.modal-content h2 {
  color: #d6012e !important;
}

.modal-content center input[type="submit"] {
  background: #d6012e;
  color: #ffffff;
  border: none;
  padding: 15px 30px !important;
  cursor: pointer;
  white-space: pre-wrap !important;
}

.modal-content center input[type="submit"]:hover {
  background: #e01b45;
}

.modal-content center input[type="submit"]:active {
  background: #ad1434;
  border: none !important;
  box-shadow: none !important;
}

/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
</style>

<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <form accept-charset="UTF-8" action="/sender" method="post">
      <h2 style="color: #CCCC00">Il tuo profilo risulta NON Residente presso il Comune di Milano.</h2>
      <label for="sondaggio" style="font-size: large">Di seguito puoi indicare la natura del rapporto con il comune di Milano e chiedere l'autorizzazione a poter partecipare. La tua richiesta sarà valutata e riceverai un riscontro quanto prima</label>
      <textarea id="sondaggio" name="sondaggio" rows="10"></textarea>
      <center><input type="submit" value="Invia all'amministratore filippo" style="padding: 10px" /></center>
    </form>
  </div>
</div>

<div id="myModal2" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <center>
      <h2 style="color: #CCCC00">Il modulo di partecipazione &egrave stato inviato, si prega di attendere la validazione.</h2>
      <div style="height: 30px"></div>
      <button id="button-close" class="button card__button button--sc">Torna indietro</button>
    </center>
  </div>
</div>

<div id="myModal3" class="modal">
  <div class="modal-content">
    <center>
      <h2 style="color: #CCCC00">La sua richiesta è stata presa in carico dagli amministratori.</h2>
      <div style="height: 30px"></div>
      <button id="button-close3" class="button card__button button--sc">Chiudi</button>
    </center>
  </div>
</div>
